<svg viewBox="0 0 500 700" xmlns="http://www.w3.org/2000/svg">
    <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
        </marker>
    </defs>

    <!-- Title -->
    <text x="250" y="30" text-anchor="middle" font-family="Arial" font-size="18" font-weight="bold" fill="#333">Tversky-All</text>

    <!-- Input -->
    <rect x="200" y="60" width="100" height="40" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
    <text x="250" y="85" text-anchor="middle" font-family="Arial" font-size="14" fill="#333">Input IDs</text>

    <line x1="250" y1="100" x2="250" y2="120" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- Embedding -->
    <rect x="200" y="120" width="100" height="40" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="5"/>
    <text x="250" y="145" text-anchor="middle" font-family="Arial" font-size="14" fill="#333">Embedding</text>

    <!-- Shared Features (positioned under embedding, to the left) -->
    <rect x="40" y="120" width="140" height="50" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2.5" rx="6"/>
    <text x="110" y="140" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="#4a148c">Shared Tversky</text>
    <text x="110" y="157" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="#4a148c">Features</text>

    <line x1="250" y1="160" x2="250" y2="200" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- Decoder Block -->
    <rect x="90" y="200" width="320" height="320" fill="#f5f5f5" stroke="#666" stroke-width="2" stroke-dasharray="5,5" rx="10"/>
    <text x="250" y="222" text-anchor="middle" font-family="Arial" font-size="13" font-weight="bold" fill="#666">Decoder Layer ×24</text>

    <!-- Pre-Attention Norm -->
    <rect x="185" y="240" width="130" height="32" fill="#e8eaf6" stroke="#3f51b5" stroke-width="2" rx="5"/>
    <text x="250" y="261" text-anchor="middle" font-family="Arial" font-size="11" fill="#333">ZeroCenteredRMSNorm</text>

    <line x1="250" y1="272" x2="250" y2="292" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- Multi-Head Attention -->
    <rect x="175" y="292" width="150" height="40" fill="#e1f5e1" stroke="#4caf50" stroke-width="2" rx="5"/>
    <text x="250" y="312" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="#333">Multi-Head Attention</text>
    <text x="250" y="327" text-anchor="middle" font-family="Arial" font-size="10" fill="#666">Q, K, V</text>

    <!-- Purple output box -->
    <rect x="195" y="337" width="110" height="20" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="1.5" rx="3"/>
    <text x="250" y="351" text-anchor="middle" font-family="Arial" font-size="10" fill="#7b1fa2" font-weight="bold">Output: Tversky</text>

    <!-- Residual 1 -->
    <path d="M 175 256 Q 135 320 175 320" fill="none" stroke="#ff9800" stroke-width="2.5" marker-end="url(#arrowhead)"/>
    <circle cx="155" cy="256" r="10" fill="#ff9800"/>
    <text x="155" y="260" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="white">+</text>

    <line x1="250" y1="357" x2="250" y2="380" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- Post-Attention Norm -->
    <rect x="185" y="380" width="130" height="32" fill="#e8eaf6" stroke="#3f51b5" stroke-width="2" rx="5"/>
    <text x="250" y="401" text-anchor="middle" font-family="Arial" font-size="11" fill="#333">ZeroCenteredRMSNorm</text>

    <line x1="250" y1="412" x2="250" y2="432" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- MLP -->
    <rect x="190" y="432" width="120" height="45" fill="#fff9c4" stroke="#fbc02d" stroke-width="2" rx="5"/>
    <text x="250" y="452" text-anchor="middle" font-family="Arial" font-size="12" fill="#333">LlamaMLP</text>
    <text x="250" y="468" text-anchor="middle" font-family="Arial" font-size="10" fill="#666">SwiGLU</text>

    <!-- Residual 2 -->
    <path d="M 175 396 Q 135 455 175 455" fill="none" stroke="#ff9800" stroke-width="2.5" marker-end="url(#arrowhead)"/>
    <circle cx="155" cy="396" r="10" fill="#ff9800"/>
    <text x="155" y="400" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="white">+</text>

    <line x1="250" y1="477" x2="250" y2="495" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

    <text x="250" y="505" text-anchor="middle" font-family="Arial" font-size="11" fill="#666" font-style="italic">↻ repeat 24×</text>

    <!-- Exit from decoder -->
    <line x1="250" y1="520" x2="250" y2="565" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- Output TverskyLayer -->
    <rect x="200" y="565" width="100" height="55" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2.5" rx="6"/>
    <text x="250" y="587" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="#4a148c">TverskyLayer</text>
    <text x="250" y="605" text-anchor="middle" font-family="Arial" font-size="9" fill="#6a1b9a">(weight-tied)</text>

    <line x1="250" y1="620" x2="250" y2="650" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- Logits -->
    <rect x="200" y="650" width="100" height="40" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
    <text x="250" y="675" text-anchor="middle" font-family="Arial" font-size="14" fill="#333">Logits</text>
</svg>
